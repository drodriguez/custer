env = Environment()

env.Append(ENV = {'PATH' : "%s:/opt/local/bin" % env['ENV']['PATH']})
env.Append(CCFLAGS = '-g -I/opt/local/include')
env.Append(LINKFLAGS = '-L/opt/local/lib')

ragel = Builder(action = 'ragel -C -o ${TARGET.abspath} ${SOURCE.file}', chdir=1)
env.Append(BUILDERS = {'Ragel' : ragel})

env.Ragel('http/parser.c', ['http/parser.rl', 'http/common.rl'])

sources = Split("""
	main.cpp
	CusterServer.cpp
	ListenEventHandler.cpp
	ClientEventHandler.cpp
	utils.cpp
	Dispatcher.cpp
	KQueueDispatcher.cpp
	HttpRequest.cpp
	HttpResponse.cpp
	DirectorySender.cpp
	http/parser.c
""")

libs = Split("""
	boost_program_options
	boost_filesystem
	boost_regex
""")

objects = env.Object(sources)
program = env.Program('custer', objects, LIBS=libs)